---
title: "Entrega 3 Análisis de Datos"
format: html
editor: visual
author: Irene LiFeng Julià Pérez y Xisco Ribera Ramis
---

Cargamos la librería

```{r, warning=FALSE, message=FALSE}
library(tidyverse)
library(dplyr)
```

# Convertir los datos en tidy

Cargamos la tabla de datos

```{r, warning=FALSE}
datos = read.csv("heart_attack_prediction_dataset.csv", header = T)
datos = datos %>% as.tibble
str(datos)
```

Vamos a modificar el data set para que sea más cómodo a la hora de trabajar con él:

```{r}
datos = datos %>% 
  mutate(Patient.ID = c(1:8763))

datos = datos %>% 
  mutate(Sex = Sex %>% as.factor)

datos = datos %>% 
  mutate(Diet = Diet %>% as.factor)

datos = datos %>% 
  mutate(Country = Country %>% as.factor)

datos = datos %>% 
  mutate(Continent = Continent %>% as.factor)

datos = datos %>% 
  mutate(Hemisphere = Hemisphere %>% as.factor)

datos = datos %>% 
  mutate(Diabetes = if_else(Diabetes == 0, "No", "Si") %>% as.factor)

datos = datos %>% 
  mutate(Family.History = if_else(Family.History == 0, "No", "Si") %>% as.factor)

datos = datos %>% 
  mutate(Smoking = if_else(Smoking == 0, "No", "Si") %>% as.factor)

datos = datos %>% 
  mutate(Obesity = if_else(Obesity == 0, "No", "Si") %>% as.factor)

datos = datos %>% 
  mutate(Alcohol.Consumption = if_else(Alcohol.Consumption == 0, "No", "Si") %>% as.factor)

datos = datos %>% 
  mutate(Previous.Heart.Problems = if_else(Previous.Heart.Problems == 0, "No", "Si") %>% as.factor)

datos = datos %>% 
  mutate(Medication.Use = if_else(Medication.Use == 0, "No", "Si") %>% as.factor)

datos = datos %>% 
  mutate(Heart.Attack.Risk = if_else(Heart.Attack.Risk == 0, "No", "Si") %>% as.factor)

# vamos a convertir la columna blood.pressure en high y low
datos <- datos %>%
  rowwise() %>%
  mutate(
    High.Blood.Pressure = as.numeric(unlist(strsplit(Blood.Pressure, "/"))[1]),
    Low.Blood.Pressure = as.numeric(unlist(strsplit(Blood.Pressure, "/"))[2])
  ) %>%
  ungroup()

datos <- datos[,c(-5,-18)]



str(datos)

```

Reordenamos las columnas

```{r}

datos <- datos %>%
  relocate(where(is.factor)) %>% 
  relocate(Patient.ID)

view(datos)
# 1 id
# 2-14 qual
# 15-26 quant
```

::: center
| qualitat                   |           Quantit           |
|:---------------------------|:---------------------------:|
|                            |                             |
| `r names(datos[,c(2:14)])` | `r names(datos[,c(15:26)])` |
:::

```{r}
summary(datos)
```

# Objetivo del estudio

1.  Estudiar algunos perfiles con riesgo de padecer un ataque al corazón
2.  Comprobar si hay diferencias entre diferentes continentes respecto al mismo perfil de riesgo.
3.  Poder predecir si un individuo tiene riesgo de sufrir un ataque al corazón.

# Análisis multivariante exploratorio

```{r, warning=FALSE}

a = datos %>% 
  select(2,6,12,14,15,16,17) %>% 
  na.omit

pairs(a, col = c("red", "blue", "green", "yellow", "purple", "orange")[as.integer(a$Continent)],pch=18)

library(GGally)

ggpairs(a)


```

## Estimación del vector de medias y la matriz de covarianza y correlación

Calculemos el vector de medias. Para cada variable cuantitativa

```{r}

apply(datos[,15:26], FUN = mean, MARGIN = 2)

```

Veamos ahora la matriz de covariancia (a secas)
```{r}
new_names = substr(names(datos[,c(15:26)]),1,5)
datos_quant <- datos[,c(15:26)]
colnames(datos_quant) = new_names


n = length(datos$Patient.ID)

round(cov(datos_quant)*(n-1)/n,5)

```

```{r}
library(psych)
corPlot(datos_quant, cex = 0.8,  main = "Matriz de correlación")

```








