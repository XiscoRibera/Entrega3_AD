---
title: "Entrega 3 Análisis de Datos"
format: html
editor: visual
author: Irene LiFeng Julià Pérez y Xisco Ribera Ramis
---

Cargamos la librería

```{r, warning=FALSE, message=FALSE}
library(tidyverse)
library(dplyr)
```

# Convertir los datos en tidy

Cargamos la tabla de datos

```{r, warning=FALSE}
datos = read.csv("heart_attack_prediction_dataset.csv", header = T)
datos = datos %>% as.tibble
str(datos)
```

Vamos a modificar el data set para que sea más cómodo a la hora de trabajar con él:

```{r}
datos = datos %>% 
  mutate(Patient.ID = c(1:8763))

datos = datos %>% 
  mutate(Sex = Sex %>% as.factor)

datos = datos %>% 
  mutate(Diet = Diet %>% as.factor)

datos = datos %>% 
  mutate(Country = Country %>% as.factor)

datos = datos %>% 
  mutate(Continent = Continent %>% as.factor)

datos = datos %>% 
  mutate(Hemisphere = Hemisphere %>% as.factor)

datos = datos %>% 
  mutate(Diabetes = if_else(Diabetes == 0, "No", "Si") %>% as.factor)

datos = datos %>% 
  mutate(Family.History = if_else(Family.History == 0, "No", "Si") %>% as.factor)

datos = datos %>% 
  mutate(Smoking = if_else(Smoking == 0, "No", "Si") %>% as.factor)

datos = datos %>% 
  mutate(Obesity = if_else(Obesity == 0, "No", "Si") %>% as.factor)

datos = datos %>% 
  mutate(Alcohol.Consumption = if_else(Alcohol.Consumption == 0, "No", "Si") %>% as.factor)

datos = datos %>% 
  mutate(Previous.Heart.Problems = if_else(Previous.Heart.Problems == 0, "No", "Si") %>% as.factor)

datos = datos %>% 
  mutate(Medication.Use = if_else(Medication.Use == 0, "No", "Si") %>% as.factor)

datos = datos %>% 
  mutate(Heart.Attack.Risk = if_else(Heart.Attack.Risk == 0, "No", "Si") %>% as.factor)

# vamos a convertir la columna blood.pressure en high y low
datos <- datos %>%
  rowwise() %>%
  mutate(
    High.Blood.Pressure = as.numeric(unlist(strsplit(Blood.Pressure, "/"))[1]),
    Low.Blood.Pressure = as.numeric(unlist(strsplit(Blood.Pressure, "/"))[2])
  ) %>%
  ungroup()

datos <- datos[,c(-5,-18)]



str(datos)

```

Reordenamos las columnas

```{r}

datos <- datos %>%
  relocate(where(is.factor)) %>% 
  relocate(Patient.ID)

view(datos)
# 1 id
# 2-14 qual
# 15-26 quant
```

::: center
| qualitat                   |           Quantit           |
|:---------------------------|:---------------------------:|
|                            |                             |
| `r names(datos[,c(2:14)])` | `r names(datos[,c(15:26)])` |
:::

```{r}
summary(datos)
```

# Análisis multivariante exploratorio

```{r, warning=FALSE, cache=TRUE}

a = datos %>% 
  select(2,6,12,14,15,16,17) %>% 
  na.omit

pairs(a, col = c("red", "blue", "green", "yellow", "purple", "orange")[as.integer(a$Continent)],pch=18)

library(GGally)

ggpairs(a)


```

## Estimación del vector de medias y la matriz de covarianza y correlación

Calculemos el vector de medias. Para cada variable cuantitativa

```{r}

apply(datos[,15:26], FUN = mean, MARGIN = 2)

```

Veamos ahora la matriz de covariancia (a secas)
```{r}
new_names = substr(names(datos[,c(15:26)]),1,5)
datos_quant <- datos[,c(15:26)]
colnames(datos_quant) = new_names


n = length(datos$Patient.ID)

round(cov(datos_quant)*(n-1)/n,5)

```

```{r}
library(psych)
corPlot(datos_quant, cex = 0.8,  main = "Matriz de correlación")

```



Separemos las variables en función de diferentes edades, ya que no hemos observado ningua correlación, ni ninguna dependencia. Nosotros suponemos que la edad sí que es un factor clave a la hora de ser un individuo de riesgo

Vamos a dividir los individuos de

```{r}
datos_menores_30 <- datos %>% 
  filter(Age < 30) %>%
  select(15:26)
colnames(datos_menores_30)=new_names
corPlot(datos_menores_30, cex = 0.8,  main = "Matriz de correlación de individuos menores de 30 años")
```


```{r}
datos_30_40 <- datos %>% 
  filter(Age >= 30) %>% 
  filter(Age < 40) %>%
  select(15:26)
colnames(datos_30_40)=new_names
corPlot(datos_30_40, cex = 0.8,  main = "Matriz de correlación de individuos de entre 30 y 40 años")
```


```{r}
datos_40_50 <- datos %>% 
  filter(Age >= 40) %>% 
  filter(Age < 50) %>%
  select(15:26)
colnames(datos_40_50)=new_names
corPlot(datos_40_50, cex = 0.8,  main = "Matriz de correlación de individuos de entre 40 y 50 años")
```


```{r}
datos_50_60 <- datos %>% 
  filter(Age >= 50) %>% 
  filter(Age < 60) %>%
  select(15:26)
colnames(datos_50_60)=new_names
corPlot(datos_50_60, cex = 0.8,  main = "Matriz de correlación de individuos de entre 50 y 60 años")
```


```{r}
datos_60_70 <- datos %>% 
  filter(Age >= 60) %>% 
  filter(Age < 70) %>%
  select(15:26)
colnames(datos_60_70)=new_names
corPlot(datos_60_70, cex = 0.8,  main = "Matriz de correlación de individuos de entre 60 y 70 años")
```


```{r}
datos_70_80 <- datos %>% 
  filter(Age >= 70) %>% 
  filter(Age < 80) %>%
  select(15:26)
colnames(datos_70_80)=new_names
corPlot(datos_70_80, cex = 0.8,  main = "Matriz de correlación de individuos de entre 70 y 80 años")
```


```{r}
datos_80_90 <- datos %>% 
  filter(Age >= 80) %>% 
  filter(Age <= 90) %>%
  select(15:26)
colnames(datos_80_90)=new_names
corPlot(datos_80_90, cex = 0.8,  main = "Matriz de correlación de individuos de entre 80 y 90 años")
```


```{r, eval=FALSE}
datos_adultos <- datos %>% 
  filter(Age >= 30) %>% 
  filter(Age <= 60) %>%
  select(15:26)
colnames(datos_adultos)=new_names
corPlot(datos_adultos, cex = 0.8,  main = "Matriz de correlación de individuos de entre 30 y 60 años")
```

Notemos que no hay mucha diferencia entre la edad de los individuos.

```{r}
#prop.table(table(datos_30_40$Heart.Attack.Risk))

```


Veamos si hay diferencias entre los continentes en los que habitan:


```{r, eval=FALSE}
table(datos$Continent)
datos_Africa <- datos %>% 
  filter(Continent == "Africa") %>%
  select(15:26)
colnames(datos_70_80)=new_names
corPlot(datos_70_80, cex = 0.8,  main = "Matriz de correlación de individuos de entre 70 y 80 años")
```



# Objetivo del estudio

1.  Estudiar algunos perfiles con riesgo de padecer un ataque al corazón
2.  Comprobar si hay diferencias entre diferentes continentes respecto al mismo perfil de riesgo.
3.  Poder predecir si un individuo tiene riesgo de sufrir un ataque al corazón.





